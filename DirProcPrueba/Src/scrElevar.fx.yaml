scrElevar As screen:
    OnHidden: =Reset(TextInput2_1)
    OnVisible: |-
        =If(IsBlank(MyLiderElevarID) && varMyUser.IdPerfil = 4, // Analyst
            UpdateContext({ 
                MyLiderElevarID: LookUp(AreaManagerLiderAnalista, IdPersonal = varMyUser.ID).IdAreaManagerLider
            });
            UpdateContext({ 
                MyLiderElevarPersonalID: LookUp(AreaManagerLider, ID = MyLiderElevarID).IdPersonal
            });
        );
        
        If(IsBlank(MyManagerElevarID) && varMyUser.IdPerfil = 3, // Leader
            UpdateContext({ 
                MyManagerElevarID: LookUp(AreaManagerLider, IdPersonal = varMyUser.ID).IdAreaManager
            });
            UpdateContext({ 
                MyManagerElevarPersonalID: LookUp(AreaManager, ID = MyManagerElevarID).IdPersonal
            });
        );

    cmpBarraSuperior_9 As cmpBarraSuperior:

    lbl_TituloPrincipal_6 As label:
        Align: =Align.Center
        FontWeight: =FontWeight.Bold
        Height: =38
        Size: =24
        Text: ="ELEVAR SOLICITUD"
        Width: =1335
        X: =13
        Y: =icn_Volver_NS_3.Y + (icn_Volver_NS_3.Height / 2) - (Self.Height / 2)
        ZIndex: =2

    icn_Volver_NS_3 As icon.BackArrow:
        Color: =icn_Volver_NS_1.Color
        Icon: =Icon.BackArrow
        OnSelect: =Back();
        X: =icn_Volver_NS_1.X
        Y: =icn_Volver_NS_1.Y
        ZIndex: =3

    Button5 As button:
        Fill: =varColorPri01
        HoverFill: =ColorFade(Self.Fill, -10%)
        OnSelect: |-
            =UpdateContext({ isLoading: true });
            
            // Crear Solicitud Detalle inicial
            UpdateContext({
            	lastSolicitudDetalle:
            		Patch(SolicitudDetalle,
            			Defaults(SolicitudDetalle),
            			{
            				IdSolicitud: varSolicitudDetalleItemSel.IdSolicitud,
            				FechaCreacion: Today(), 
            				FechaExpiraSLA: varSolicitudDetalleItemSel.FechaExpiraSLA,
                            FechaExpiraOLA: varSolicitudDetalleItemSel.FechaExpiraOLA,
                            // Cuando se deriva, la fecha OLA se debe volver a generar ya que cada Area tiene un OLA distinto
            				//FechaExpiraOLA: DateAdd(Today(); varMyUserArea.OLA);
            				EsAtendido: false,
            				IdAccionOrigen: 3, // Elevar
            				IdEtapaOrigen: varSolicitudDetalleItemSel.IdEtapaActual,
            				IdAreaOrigen: varMyUser.IdArea,
            				IdPerfilOrigen: varMyUser.IdPerfil,
            				IdPersonalOrigen: varMyUser.ID,
            				IdAccionActual: 0, // Lo actualizará el siguiente usuario
            				IdEtapaActual: varSolicitudDetalleItemSel.IdEtapaActual,
            				IdAreaActual: varSolicitudDetalleItemSel.IdAreaActual,
                            // Si fuera derivar, Perfil y persona quedaria en 0 porque es de uno a muchos
            				IdPerfilActual: LookUp(Personal, ID = varSolicitudDetalleItemSel.IdPersonalOrigen).IdPerfil,
            				IdPersonalActual: varSolicitudDetalleItemSel.IdPersonalOrigen,
                            IdAccionDestino: 0, // Siempre será 0 porque todavía no se toma en cuenta
            				IdEtapaDestino: 0, // Etapa Destino Real
            				IdAreaDestino: 0, // Area Destino Real
            				IdPerfilDestino: 0, // Perfil Destino Real
            				IdPersonalDestino: 0, // Personal Destino 
                            //IdEtapaDestinoFlujo: varMyAreaEtapaFlujo.IdEtapaDestino;
                            IdEtapaDestinoFlujo: varSolicitudDetalleItemSel.IdEtapaDestinoFlujo,
                            //IdAreaDestinoFlujo: varMyAreaEtapaFlujo.IdAreaDestino;
                            IdAreaDestinoFlujo: varSolicitudDetalleItemSel.IdAreaDestinoFlujo,
                            ObsSolDet: TrimEnds(TextInput2_1.Text)
                        }
            		)
            });
            
            // Crear Solicitud Detalle Destino del siguiente usuario
            Patch(SolicitudDetalleDestino,
            	Defaults(SolicitudDetalleDestino),
            	{
            		IdSolicitud: lastSolicitudDetalle.IdSolicitud,
            		IdSolicitudDetalle: lastSolicitudDetalle.ID,
            		IdEtapaDestino: lastSolicitudDetalle.IdEtapaActual,
            		IdAreaDestino: lastSolicitudDetalle.IdAreaActual,
            		IdPerfilDestino: lastSolicitudDetalle.IdPerfilActual,
            		IdPersonalDestino: lastSolicitudDetalle.IdPersonalActual
            	}
            );
            
            // Actualizar Solicitud seleccionada con los datos de la persona que esta realizando la accion
            Patch(SolicitudDetalle, 
                LookUp(SolicitudDetalle, ID = varSolicitudDetalleItemSel.ID),
                {
                    IdAccionActual: 3, // Elevar
                    IdPerfilActual: varMyUser.IdPerfil,
                    IdPersonalActual: varMyUser.ID,
                    IdAreaDestino: varSolicitudDetalleItemSel.IdAreaActual,
                    IdEtapaDestino: varSolicitudDetalleItemSel.IdEtapaActual,
                    IdPerfilDestino: lastSolicitudDetalle.IdPerfilActual,
                    IdPersonalDestino: lastSolicitudDetalle.IdPersonalActual,
                    EsAtendido: true, // Actualizar estado del registro seleccionado
                    IdSolicitudDetalleGenerada: lastSolicitudDetalle.ID, // Guardar ID de la solicitud detalle generada
                    ObsSolDetDestino: TrimEnds(TextInput2_1.Text),
                    FechaAtencion: Today()
                }
            );
            
            Notify("Solicitud elevada correctamente.", NotificationType.Success);
            
            UpdateContext({ isLoading: false });
            
            Navigate(scrMisSolicitudes, Fade);
        Text: ="ELEVAR"
        Width: =Parent.Width / 2
        X: =Parent.Width / 2 - Self.Width / 2
        Y: =Parent.Height - Self.Height - 35
        ZIndex: =4

    TextInput2_1 As text:
        BorderColor: =varColorPri01B
        Default: =""
        Height: =60
        HoverBorderColor: =varColorPri01B
        HoverFill: =varColorPri01B
        Mode: =TextMode.MultiLine
        RadiusBottomLeft: =0
        RadiusBottomRight: =0
        RadiusTopLeft: =0
        RadiusTopRight: =0
        Width: =Rectangle5_8.X + Rectangle5_8.Width - Self.X
        X: =requestFieldLbl_27.X
        Y: =requestFieldLbl_27.Y + requestFieldLbl_27.Height + 15
        ZIndex: =9

    Label6_16 As label:
        FontWeight: =FontWeight.Semibold
        Height: =20
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Text: ="ID"
        Width: =(Parent.Width - 250) / 4
        X: =Button8_4.X
        Y: =Button8_4.Y + Button8_4.Height + 15
        ZIndex: =16

    TextInput4_14 As text:
        BorderThickness: =0
        Default: =varSolicitudDetalleItemSel.ID
        DisabledColor: =RGBA(0, 0, 0, 1)
        DisabledFill: =RGBA(244, 244, 244, 0)
        DisplayMode: =DisplayMode.Disabled
        FocusedBorderThickness: =0
        Height: =25
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Width: =Label6_16.Width
        X: =Label6_16.X
        Y: =Label6_16.Y + Label6_16.Height
        ZIndex: =17

    Label6_17 As label:
        FontWeight: =FontWeight.Semibold
        Height: =20
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Text: ="Nro. Ticket"
        Width: =Label6_16.Width
        X: =Label6_16.X + Label6_16.Width + 50
        Y: =Label6_16.Y
        ZIndex: =18

    TextInput4_15 As text:
        BorderThickness: =0
        Default: =varSolicitudDetalleItemSel.NroSolicitud
        DisabledColor: =RGBA(0, 0, 0, 1)
        DisabledFill: =RGBA(244, 244, 244, 0)
        DisplayMode: =DisplayMode.Disabled
        FocusedBorderThickness: =0
        Height: =25
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Width: =Label6_17.Width
        X: =Label6_17.X
        Y: =Label6_17.Y + Label6_17.Height
        ZIndex: =19

    Label6_18 As label:
        FontWeight: =FontWeight.Semibold
        Height: =20
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Text: ="Tipo de Solicitud"
        Width: =Label6_16.Width
        X: =Label6_17.X + Label6_17.Width + 50
        Y: =Label6_17.Y
        ZIndex: =20

    TextInput4_16 As text:
        BorderThickness: =0
        Default: =varSolicitudDetalleItemSel.TipoSolicitud
        DisabledColor: =RGBA(0, 0, 0, 1)
        DisabledFill: =RGBA(244, 244, 244, 0)
        DisplayMode: =DisplayMode.Disabled
        FocusedBorderThickness: =0
        Height: =25
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Width: =Label6_18.Width
        X: =Label6_18.X
        Y: =Label6_18.Y + Label6_18.Height
        ZIndex: =21

    Label6_19 As label:
        FontWeight: =FontWeight.Semibold
        Height: =20
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Text: ="Tipo de Servicio"
        Width: =Label6_16.Width
        X: =Label6_18.X + Label6_18.Width + 50
        Y: =Label6_18.Y
        ZIndex: =22

    TextInput4_17 As text:
        BorderThickness: =0
        Default: =varSolicitudDetalleItemSel.TipoServicio
        DisabledColor: =RGBA(0, 0, 0, 1)
        DisabledFill: =RGBA(244, 244, 244, 0)
        DisplayMode: =DisplayMode.Disabled
        FocusedBorderThickness: =0
        Height: =25
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Width: =Label6_19.Width
        X: =Label6_19.X
        Y: =Label6_19.Y + Label6_19.Height
        ZIndex: =23

    Label6_20 As label:
        FontWeight: =FontWeight.Semibold
        Height: =20
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Text: ="Nombre de Solicitud"
        Width: =TextInput4_15.X + TextInput4_15.Width - Self.X
        X: =TextInput4_14.X
        Y: =TextInput4_14.Y + TextInput4_14.Height + 15
        ZIndex: =24

    TextInput4_18 As text:
        BorderThickness: =0
        Default: =varSolicitudDetalleItemSel.NombreSolicitud
        DisabledColor: =RGBA(0, 0, 0, 1)
        DisabledFill: =RGBA(244, 244, 244, 0)
        DisplayMode: =DisplayMode.Disabled
        FocusedBorderThickness: =0
        Height: =25
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Width: =Label6_20.Width
        X: =Label6_20.X
        Y: =Label6_20.Y + Label6_20.Height
        ZIndex: =25

    Label6_21 As label:
        FontWeight: =FontWeight.Semibold
        Height: =20
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Text: ="Observación"
        Width: =TextInput4_17.X + TextInput4_17.Width - Self.X
        X: =Label6_20.X + Label6_20.Width + 50
        Y: =Label6_20.Y
        ZIndex: =26

    Label6_22 As label:
        Height: =50
        Overflow: =Overflow.Scroll
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        Text: =varSolicitudDetalleItemSel.ObsSolDet
        Width: =Label6_21.Width
        X: =Label6_21.X
        Y: =Label6_21.Y + Label6_21.Height
        ZIndex: =27

    Label6_23 As label:
        FontWeight: =FontWeight.Semibold
        Height: =20
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Text: ="F. Creación"
        Width: =(Parent.Width - 200) / 3
        X: =Button8_7.X
        Y: =Button8_7.Y + Button8_7.Height + 15
        ZIndex: =28

    TextInput4_19 As text:
        BorderThickness: =0
        Default: =Text(varSolicitudDetalleItemSel.FechaCreacion, "dd/mm/yyyy")
        DisabledColor: =RGBA(0, 0, 0, 1)
        DisabledFill: =RGBA(244, 244, 244, 0)
        DisplayMode: =DisplayMode.Disabled
        FocusedBorderThickness: =0
        Height: =25
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Width: =Label6_23.Width
        X: =Label6_23.X
        Y: =Label6_23.Y + Label6_23.Height
        ZIndex: =29

    Label6_24 As label:
        FontWeight: =FontWeight.Semibold
        Height: =20
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Text: ="F. Expiración SLA"
        Width: =Label6_23.Width
        X: =Label6_23.X + Label6_23.Width + 50
        Y: =Label6_23.Y
        ZIndex: =30

    TextInput4_20 As text:
        BorderThickness: =0
        Default: =Text(varSolicitudDetalleItemSel.FechaExpiraSLA, "dd/mm/yyyy")
        DisabledColor: =RGBA(0, 0, 0, 1)
        DisabledFill: =RGBA(244, 244, 244, 0)
        DisplayMode: =DisplayMode.Disabled
        FocusedBorderThickness: =0
        Height: =25
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Width: =Label6_24.Width
        X: =Label6_24.X
        Y: =Label6_24.Y + Label6_24.Height
        ZIndex: =31

    Label6_25 As label:
        FontWeight: =FontWeight.Semibold
        Height: =20
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Text: ="F. Expiración OLA"
        Width: =Label6_24.Width
        X: =Label6_24.X + Label6_24.Width + 50
        Y: =Label6_24.Y
        ZIndex: =32

    TextInput4_21 As text:
        BorderThickness: =0
        Default: =Text(varSolicitudDetalleItemSel.FechaExpiraOLA, "dd/mm/yyyy")
        DisabledColor: =RGBA(0, 0, 0, 1)
        DisabledFill: =RGBA(244, 244, 244, 0)
        DisplayMode: =DisplayMode.Disabled
        FocusedBorderThickness: =0
        Height: =25
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Width: =Label6_25.Width
        X: =Label6_25.X
        Y: =Label6_25.Y + Label6_25.Height
        ZIndex: =33

    requestFieldLbl_27 As label:
        FontWeight: =FontWeight.Semibold
        Height: =20
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Text: ="Comentarios"
        X: =requestFieldLbl_26.X
        Y: =Icon4.Y + Icon4.Height + 15
        ZIndex: =34

    Rectangle2_8 As rectangle:
        Fill: =RGBA(0, 0, 0, 0.4)
        Height: =Parent.Height
        Visible: =isLoading
        Width: =Parent.Width
        ZIndex: =35

    upperToGroup As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =37

        requestFieldLbl_26 As label:
            FontWeight: =FontWeight.Semibold
            Height: =20
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: |-
                ="Elevar Solicitud a:"
            X: =Button8_8.X
            Y: =Button8_8.Y + Button8_8.Height + 15
            ZIndex: =5

        Icon4 As icon.Person:
            Color: =varColorPri01
            DisplayMode: =DisplayMode.View
            Icon: =Icon.Person
            PaddingLeft: =5
            PaddingRight: =5
            X: =requestFieldLbl_26.X + requestFieldLbl_26.Width + 15
            Y: =requestFieldLbl_26.Y
            ZIndex: =6

        requestFieldLbl_75 As label:
            FontWeight: =FontWeight.Semibold
            Height: =Icon4.Height / 2
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: |-
                =/*If(IsBlank(MyLiderElevarPersonalID) && varMyUser.IdPerfil = 4; // Analyst
                    LookUp(Personal; ID = MyLiderElevarPersonalID).Nombre;
                
                    IsBlank(MyManagerElevarPersonalID) && varMyUser.IdPerfil = 3; // Leader
                    LookUp(Personal; ID = MyManagerElevarPersonalID).Nombre
                )*/
                LookUp(Personal, ID = varSolicitudDetalleItemSel.IdPersonalOrigen).Nombre
            VerticalAlign: =VerticalAlign.Bottom
            Width: =Rectangle5_8.X + Rectangle5_8.Width - Self.X
            X: =Icon4.X + Icon4.Width
            Y: =Icon4.Y
            ZIndex: =7

        requestFieldLbl_59 As label:
            Height: =Icon4.Height / 2
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: =LookUp(Perfil, ID = varSolicitudDetalleItemSel.IdPerfilOrigen).Nombre
            VerticalAlign: =VerticalAlign.Top
            Width: =Rectangle5_8.X + Rectangle5_8.Width - Self.X
            X: =Icon4.X + Icon4.Width
            Y: =requestFieldLbl_75.Y + requestFieldLbl_75.Height
            ZIndex: =8

    Group8_4 As group:
        Height: =5
        Width: =5
        X: =60
        Y: =60
        ZIndex: =69

        Button8_4 As button:
            Align: =Align.Left
            BorderThickness: =0
            DisabledColor: =RGBA(255, 255, 255, 1)
            DisabledFill: =varColorPri01
            DisplayMode: =DisplayMode.Disabled
            FocusedBorderThickness: =0
            PaddingLeft: =15
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =40
            Text: ="Datos de Solicitud"
            Width: =230
            X: =50
            Y: =115
            ZIndex: =10

        Rectangle5_4 As rectangle:
            Fill: =varColorPri01
            Height: =2
            Width: =Parent.Width - Self.X - 50
            X: =Button8_4.X
            Y: =Button8_4.Y + Button8_4.Height - Self.Height
            ZIndex: =11

    Group8_7 As group:
        Height: =5
        Width: =5
        X: =70
        Y: =500
        ZIndex: =72

        Button8_7 As button:
            Align: =Align.Left
            BorderThickness: =0
            DisabledColor: =RGBA(255, 255, 255, 1)
            DisabledFill: =varColorPri01
            DisplayMode: =DisplayMode.Disabled
            FocusedBorderThickness: =0
            PaddingLeft: =15
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =40
            Text: ="Datos de Fecha"
            Width: =230
            X: =TextInput4_18.X
            Y: =TextInput4_18.Y + TextInput4_18.Height + 15
            ZIndex: =12

        Rectangle5_7 As rectangle:
            Fill: =varColorPri01
            Height: =2
            Width: =Parent.Width - Self.X - 50
            X: =Button8_7.X
            Y: =Button8_7.Y + Button8_7.Height - Self.Height
            ZIndex: =13

    Group8_8 As group:
        Height: =5
        Width: =5
        X: =70
        Y: =280
        ZIndex: =72

        Button8_8 As button:
            Align: =Align.Left
            BorderThickness: =0
            DisabledColor: =RGBA(255, 255, 255, 1)
            DisabledFill: =varColorPri01
            DisplayMode: =DisplayMode.Disabled
            FocusedBorderThickness: =0
            PaddingLeft: =15
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =40
            Text: ="Datos de Operación"
            Width: =240
            X: =TextInput4_19.X
            Y: =TextInput4_19.Y + TextInput4_19.Height + 15
            ZIndex: =14

        Rectangle5_8 As rectangle:
            Fill: =varColorPri01
            Height: =2
            Width: =Parent.Width - Self.X - 50
            X: =Button8_8.X
            Y: =Button8_8.Y + Button8_8.Height - Self.Height
            ZIndex: =15

