srcSolicitudDetalle As screen:
    OnHidden: =
    OnVisible: |-
        =// Get AreaManager ID if is blank
        If(IsBlank(MyAreaManagerID) && varMyUser.IdPerfil = 2,
        	Set(MyAreaManagerID, LookUp(AreaManager, IdPersonal = varMyUser.ID).ID)
        );
        
        // Get AreaManagerLider ID if is blank
        If(IsBlank(MyAreaManagerLiderID) && varMyUser.IdPerfil = 3,
        	Set(MyAreaManagerLiderID, LookUp(AreaManagerLider, IdPersonal = varMyUser.ID).ID)
        );

    cmpBarraSuperior_7 As cmpBarraSuperior:

    lbl_TituloPrincipal_4 As label:
        Align: =Align.Center
        FontWeight: =FontWeight.Bold
        Height: =38
        Size: =24
        Text: ="CREACION DE SOLICITUD"
        Width: =1335
        X: =13
        Y: =icn_Volver_NS_1.Y + (icn_Volver_NS_1.Height / 2) - (Self.Height / 2)
        ZIndex: =2

    icn_Volver_NS_1 As icon.BackArrow:
        Icon: =Icon.BackArrow
        OnSelect: =Back();
        X: =60
        Y: =100
        ZIndex: =3

    requestFieldGroup_1 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =6

        requestFieldLbl_1 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="ID"
            Width: =30
            X: =icn_Volver_NS_1.X
            Y: =180
            ZIndex: =4

        requestFieldTxt_1 As text:
            Default: =Gallery1.Selected.ID
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =120
            X: =requestFieldLbl_1.X + requestFieldLbl_1.Width
            Y: =requestFieldLbl_1.Y
            ZIndex: =5

    requestFieldGroup_2 As group:
        Height: =5
        Width: =5
        X: =20
        Y: =20
        ZIndex: =8

        requestFieldLbl_2 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="Nro. Ticket"
            Width: =100
            X: =requestFieldTxt_1.X + requestFieldTxt_1.Width + 50
            Y: =requestFieldLbl_1.Y
            ZIndex: =6

        requestFieldTxt_2 As text:
            Default: =Gallery1.Selected.NroSolicitud
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =120
            X: =requestFieldLbl_2.X + requestFieldLbl_2.Width
            Y: =requestFieldLbl_2.Y
            ZIndex: =7

    requestFieldGroup_3 As group:
        Height: =5
        Width: =5
        X: =20
        Y: =220
        ZIndex: =10

        requestFieldLbl_3 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="Nombre de Solicitud"
            Width: =180
            X: =requestFieldLbl_1.X
            Y: =requestFieldLbl_1.Y + requestFieldLbl_1.Height + 40
            ZIndex: =8

        requestFieldTxt_3 As text:
            Default: =Gallery1.Selected.NombreSolicitud
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =500
            X: =requestFieldLbl_3.X + requestFieldLbl_3.Width
            Y: =requestFieldLbl_3.Y
            ZIndex: =9

    requestFieldGroup_4 As group:
        Height: =5
        Width: =5
        X: =80
        Y: =20
        ZIndex: =12

        requestFieldLbl_4 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="Tipo de Solicitud"
            X: =requestFieldTxt_2.X + requestFieldTxt_2.Width + 50
            Y: =requestFieldTxt_2.Y
            ZIndex: =10

        requestFieldTxt_4 As text:
            Default: =Gallery1.Selected.TipoSolicitud
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =200
            X: =requestFieldLbl_4.X + requestFieldLbl_4.Width
            Y: =requestFieldLbl_4.Y
            ZIndex: =11

    requestFieldGroup_5 As group:
        Height: =5
        Width: =5
        X: =80
        Y: =20
        ZIndex: =15

        requestFieldLbl_5 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="Tipo de Servicio"
            Width: =140
            X: =requestFieldTxt_4.X + requestFieldTxt_4.Width + 50
            Y: =requestFieldLbl_4.Y
            ZIndex: =12

        requestFieldTxt_5 As text:
            Default: =Gallery1.Selected.TipoServicio
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =200
            X: =requestFieldLbl_5.X + requestFieldLbl_5.Width
            Y: =requestFieldLbl_5.Y
            ZIndex: =13

    requestFieldGroup_6 As group:
        Height: =5
        Width: =5
        X: =80
        Y: =20
        ZIndex: =18

        requestFieldLbl_6 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="Estado"
            Width: =70
            X: =requestFieldTxt_3.X + requestFieldTxt_3.Width + 130
            Y: =requestFieldTxt_3.Y
            ZIndex: =14

        requestFieldTxt_6 As text:
            Default: =If(Gallery1.Selected.EsActivo, "Activo", If(Gallery1.Selected.EsEliminado, "Eliminado", "Inactivo"))
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =200
            X: =requestFieldLbl_6.X + requestFieldLbl_6.Width
            Y: =requestFieldLbl_6.Y
            ZIndex: =15

    requestFieldGroup_7 As group:
        Height: =5
        Width: =5
        X: =80
        Y: =300
        ZIndex: =20

        requestFieldLbl_7 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="Dpto. de Procedencia"
            Width: =190
            X: =requestFieldLbl_3.X
            Y: =requestFieldLbl_3.Y + requestFieldLbl_3.Height + 40
            ZIndex: =16

        requestFieldTxt_7 As text:
            Default: =Gallery1.Selected.AreaOrigen
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =200
            X: =requestFieldLbl_7.X + requestFieldLbl_7.Width
            Y: =requestFieldLbl_7.Y
            ZIndex: =17

    requestFieldGroup_8 As group:
        Height: =5
        Width: =5
        X: =80
        Y: =300
        ZIndex: =23

        requestFieldLbl_8 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="Dpto. Actual"
            Width: =140
            X: =requestFieldTxt_7.X + requestFieldTxt_7.Width + 50
            Y: =requestFieldLbl_7.Y
            ZIndex: =18

        requestFieldTxt_8 As text:
            Default: =Gallery1.Selected.AreaActual
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =200
            X: =requestFieldLbl_8.X + requestFieldLbl_8.Width
            Y: =requestFieldLbl_8.Y
            ZIndex: =19

    requestFieldGroup_9 As group:
        Height: =5
        Width: =5
        X: =80
        Y: =300
        ZIndex: =25

        requestFieldLbl_9 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="Manager"
            Width: =90
            X: =requestFieldLbl_1.X
            Y: =requestFieldLbl_7.Y + requestFieldLbl_7.Height + 40
            ZIndex: =22

        requestFieldTxt_9 As text:
            Default: =Gallery1.Selected.ManagerDelArea
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =300
            X: =requestFieldLbl_9.X + requestFieldLbl_9.Width
            Y: =requestFieldLbl_9.Y
            ZIndex: =23

    requestFieldGroup_10 As group:
        Height: =5
        Width: =5
        X: =80
        Y: =300
        ZIndex: =28

        requestFieldLbl_10 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="Lider"
            Width: =60
            X: =requestFieldTxt_9.X + requestFieldTxt_9.Width + 50
            Y: =requestFieldLbl_9.Y
            ZIndex: =24

        requestFieldTxt_10 As text:
            Default: =Gallery1.Selected.LiderDelArea
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =300
            X: =requestFieldLbl_10.X + requestFieldLbl_10.Width
            Y: =requestFieldLbl_10.Y
            ZIndex: =25

    requestFieldGroup_11 As group:
        Height: =5
        Width: =5
        X: =80
        Y: =300
        ZIndex: =31

        requestFieldLbl_11 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="Analista"
            Width: =80
            X: =requestFieldTxt_10.X + requestFieldTxt_10.Width + 60
            Y: =requestFieldLbl_9.Y
            ZIndex: =26

        requestFieldTxt_11 As text:
            Default: =Gallery1.Selected.AnalistaDelArea
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =300
            X: =requestFieldLbl_11.X + requestFieldLbl_11.Width
            Y: =requestFieldLbl_11.Y
            ZIndex: =27

    requestFieldGroup_12 As group:
        Height: =5
        Width: =5
        X: =80
        Y: =380
        ZIndex: =33

        requestFieldLbl_12 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="F. Creación"
            Width: =110
            X: =requestFieldLbl_9.X
            Y: =requestFieldLbl_9.Y + requestFieldLbl_9.Height + 40
            ZIndex: =28

        requestFieldTxt_12 As text:
            Default: =Gallery1.Selected.FechaAtencion
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =180
            X: =requestFieldLbl_12.X + requestFieldLbl_12.Width
            Y: =requestFieldLbl_12.Y
            ZIndex: =29

    requestFieldGroup_13 As group:
        Height: =5
        Width: =5
        X: =80
        Y: =380
        ZIndex: =36

        requestFieldLbl_13 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="F. Expiración SLA"
            X: =requestFieldTxt_12.X + requestFieldTxt_12.Width + 50
            Y: =requestFieldLbl_12.Y
            ZIndex: =30

        requestFieldTxt_13 As text:
            Default: =Text(Gallery1.Selected.FechaExpiraSLA, "dd/mm/yyyy")
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =180
            X: =requestFieldLbl_13.X + requestFieldLbl_13.Width
            Y: =requestFieldLbl_13.Y
            ZIndex: =31

    actionButtonsGroup As group:
        Height: =5
        Width: =5
        X: =80
        Y: =80
        ZIndex: =46

        descargarPDFBtn As button:
            Size: =12
            Text: ="Descargar PDF"
            X: =40
            Y: =Parent.Height - Self.Height - 20
            ZIndex: =37

        trazabilidadBtn As button:
            OnSelect: =Navigate(scrTrazabilidad, ScreenTransition.Fade)
            Size: =12
            Text: ="Trazabilidad"
            X: =descargarPDFBtn.X + descargarPDFBtn.Width + 25
            Y: =descargarPDFBtn.Y
            ZIndex: =38

        elevarBtn As button:
            OnSelect: =Navigate(scrElevar, ScreenTransition.Fade)
            Size: =12
            Text: ="Elevar"
            X: =trazabilidadBtn.X + trazabilidadBtn.Width + 25
            Y: =descargarPDFBtn.Y
            ZIndex: =39

        asignarBtn As button:
            OnSelect: =Navigate(scrAsignar, ScreenTransition.Fade)
            Size: =12
            Text: ="Asignar"
            X: =elevarBtn.X + elevarBtn.Width + 25
            Y: =descargarPDFBtn.Y
            ZIndex: =40

        derivarBtn As button:
            OnSelect: =Navigate(scrDerivar, ScreenTransition.Fade)
            Size: =12
            Text: ="Derivar"
            X: =asignarBtn.X + asignarBtn.Width + 25
            Y: =descargarPDFBtn.Y
            ZIndex: =41

        archivarBtn As button:
            OnSelect: |-
                =Reset(TextInput3);
                UpdateContext({ showArchiveDialog: true })
            Size: =12
            Text: ="Archivar"
            X: =derivarBtn.X + derivarBtn.Width + 25
            Y: =descargarPDFBtn.Y
            ZIndex: =42

        eliminarBtn As button:
            OnSelect: |-
                =Reset(TextInput3_1);
                UpdateContext({ showDeleteDialog: true })
            Size: =12
            Text: ="Eliminar"
            X: =archivarBtn.X + archivarBtn.Width + 25
            Y: =descargarPDFBtn.Y
            ZIndex: =43

    descriptionGroup As group:
        Height: =5
        Width: =5
        X: =80
        Y: =80
        ZIndex: =56

        requestFieldLbl_14 As label:
            Color: =RGBA(0, 18, 107, 1)
            Height: =20
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: |-
                ="Observación: "
            Width: =110
            X: =requestFieldLbl_12.X
            Y: =requestFieldLbl_12.Y + requestFieldLbl_12.Height + 50
            ZIndex: =34

        requestFieldScrollLbl As label:
            Align: =Align.Justify
            AutoHeight: =true
            Color: =RGBA(0, 18, 107, 0)
            Height: =80
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: =requestFieldLbl_15.Text
            Width: =requestFieldTxt_11.X + requestFieldTxt_11.Width - Self.X
            X: =requestFieldLbl_14.X + requestFieldLbl_14.Width
            Y: =requestFieldLbl_14.Y
            ZIndex: =35

        requestFieldLbl_15 As label:
            Align: =Align.Justify
            Color: =RGBA(0, 18, 107, 1)
            Height: =Min(requestFieldScrollLbl.Height, 85)
            Overflow: =Overflow.Scroll
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: =Gallery1.Selected.ObsSolDet
            Width: =requestFieldTxt_11.X + requestFieldTxt_11.Width - Self.X
            X: =requestFieldLbl_14.X + requestFieldLbl_14.Width
            Y: =requestFieldLbl_14.Y
            ZIndex: =36

    requestFieldGroup_38 As group:
        Height: =5
        Width: =5
        X: =420
        Y: =520
        ZIndex: =58

        requestFieldLbl_28 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="F. Expiración OLA"
            X: =requestFieldTxt_13.X + requestFieldTxt_13.Width + 50
            Y: =requestFieldLbl_12.Y
            ZIndex: =32

        requestFieldTxt_38 As text:
            Default: =Text(Gallery1.Selected.FechaExpiraOLA, "dd/mm/yyyy")
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =180
            X: =requestFieldLbl_28.X + requestFieldLbl_28.Width
            Y: =requestFieldLbl_28.Y
            ZIndex: =33

    Rectangle2_9 As rectangle:
        Fill: =RGBA(0, 0, 0, 0.4)
        Height: =Parent.Height
        Visible: =isLoading
        Width: =Parent.Width
        ZIndex: =58

    requestFieldGroup_39 As group:
        Height: =5
        Width: =5
        X: =520
        Y: =360
        ZIndex: =60

        requestFieldLbl_40 As label:
            Color: =RGBA(0, 18, 107, 1)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="Dpto. Asignado"
            Width: =140
            X: =requestFieldTxt_8.X + requestFieldTxt_8.Width + 50
            Y: =requestFieldLbl_7.Y
            ZIndex: =20

        requestFieldTxt_39 As text:
            Default: =Gallery1.Selected.AreaDestino
            DisplayMode: =DisplayMode.Disabled
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =200
            X: =requestFieldLbl_40.X + requestFieldLbl_40.Width
            Y: =requestFieldLbl_40.Y
            ZIndex: =21

    archiveDialogGroup As group:
        Height: =5
        Width: =5
        X: =80
        Y: =80
        ZIndex: =61

        confirmDialogRect_2 As rectangle:
            DisplayMode: =DisplayMode.View
            Fill: =RGBA(0, 0, 0, 0.5)
            FocusedBorderThickness: =0
            Height: =Parent.Height
            Visible: =showArchiveDialog
            Width: =Parent.Width
            ZIndex: =44

        confirmDialogFrame_2 As button:
            BorderThickness: =0
            DisabledFill: =Color.White
            DisplayMode: =DisplayMode.Disabled
            FocusedBorderThickness: =0
            Height: =300
            RadiusBottomLeft: =20
            RadiusBottomRight: =20
            RadiusTopLeft: =20
            RadiusTopRight: =20
            Text: =""
            Visible: =showArchiveDialog
            Width: =600
            X: =Parent.Width / 2 - Self.Width / 2
            Y: =Parent.Height / 2 - Self.Height / 2
            ZIndex: =45

        confirmDialogTitle_2 As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Text: ="¿ESTA SEGURO DE ARCHIVAR LA SOLICITUD?"
            Visible: =showArchiveDialog
            Width: =confirmDialogFrame_2.Width
            X: =confirmDialogFrame_2.X
            Y: =confirmDialogFrame_2.Y + 15
            ZIndex: =46

        commentaryLbl As label:
            Height: =20
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =12
            Text: |-
                ="Comentario:"
            Visible: =showArchiveDialog
            Width: =100
            X: =confirmDialogFrame_2.X + 20
            Y: =confirmDialogTitle_2.Y + confirmDialogTitle_2.Height + 15
            ZIndex: =47

        TextInput3 As text:
            Default: =""
            Height: =120
            HintText: ="Ingrese un comentario..."
            Mode: =TextMode.MultiLine
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Visible: =showArchiveDialog
            Width: =confirmDialogFrame_2.X + confirmDialogFrame_2.Width - Self.X - 20
            X: =confirmDialogFrame_2.X + 20
            Y: =commentaryLbl.Y + commentaryLbl.Height + 5
            ZIndex: =48

        aceptarBtn As button:
            DisplayMode: =If(IsBlank(TrimEnds(TextInput3.Text)), DisplayMode.Disabled, DisplayMode.Edit)
            OnSelect: |-
                =UpdateContext({ showArchiveDialog: false, isLoading: true });
                
                // Actualizar datos base de solicitud
                Patch(Solicitud, 
                	LookUp(Solicitud, ID = Gallery1.Selected.ID), 
                	{ 
                		EsActivo: false 
                	}
                );
                
                // Crear Solicitud Detalle inicial
                UpdateContext({
                	lastSolicitudDetalle:
                		Patch(SolicitudDetalle,
                			Defaults(SolicitudDetalle),
                			{
                				IdSolicitud: Gallery1.Selected.IdSolicitud,
                				FechaAtencion: Today(),
                				FechaExpiraSLA: Gallery1.Selected.FechaExpiraSLA,
                                FechaExpiraOLA: Gallery1.Selected.FechaExpiraOLA,
                                // Cuando se deriva, la fecha OLA se debe volver a generar ya que cada Area tiene un OLA distinto
                				//FechaExpiraOLA: DateAdd(Today(); varMyUserArea.OLA);
                				EsAtendido: false,
                				IdAccionOrigen: 6, // Anular
                				IdEtapaOrigen: Gallery1.Selected.IdEtapaActual,
                				IdAreaOrigen: varMyUser.IdArea,
                				IdPerfilOrigen: varMyUser.IdPerfil,
                				IdPersonalOrigen: varMyUser.ID,
                				IdAccionActual: 0, // Lo actualizará el siguiente usuario
                				IdEtapaActual: 0,
                				IdAreaActual: 0,
                                // Si fuera derivar, Perfil y persona quedaria en 0 porque es de uno a muchos
                				IdPerfilActual: 0,
                				IdPersonalActual: 0,
                                IdAccionDestino: 0, // Siempre será 0 porque todavía no se toma en cuenta
                				IdEtapaDestino: 0, // Etapa Destino Real
                				IdAreaDestino: 0, // Area Destino Real
                				IdPerfilDestino: 0, // Perfil Destino Real
                				IdPersonalDestino: 0, // Personal Destino 
                                IdEtapaDestinoFlujo: varMyAreaEtapaFlujo.IdEtapaDestino,
                                IdAreaDestinoFlujo: varMyAreaEtapaFlujo.IdAreaDestino,
                                ObsSolDet: TrimEnds(TextInput3.Text)
                			}
                		)
                });
                
                // Actualizar Solicitud seleccionada con los datos de la persona que esta realizando la accion
                Patch(SolicitudDetalle, 
                    LookUp(SolicitudDetalle, ID = Gallery1.Selected.ID),
                    {
                        IdAccionActual: 6, // Anular
                        IdPerfilActual: varMyUser.IdPerfil,
                        IdPersonalActual: varMyUser.ID,
                        IdAreaDestino: 0,
                        IdEtapaDestino: 0,
                        IdPerfilDestino: 0,
                        IdPersonalDestino: 0,
                        EsAtendido: true, // Actualizar estado del registro seleccionado
                        IdSolicitudDetalleGenerada: lastSolicitudDetalle.ID, // Guardar ID de la solicitud detalle generada
                        ObsSolDetDestino: TrimEnds(TextInput3.Text)
                    }
                );
                
                Notify("Solicitud archivada correctamente.", NotificationType.Success);
                
                Reset(TextInput3);
                
                UpdateContext({ isLoading: false });
                
                Navigate(scrMisSolicitudes, Fade);
            Size: =12
            Text: ="Aceptar"
            Visible: =showArchiveDialog
            X: =confirmDialogFrame_2.X + (confirmDialogFrame_2.Width / 2) - Self.Width - 20
            Y: =confirmDialogFrame_2.Y + confirmDialogFrame_2.Height - Self.Height - 20
            ZIndex: =49

        cancelarBtn As button:
            OnSelect: |-
                =UpdateContext({ showArchiveDialog: false });
                Reset(TextInput3)
            Size: =12
            Text: ="Cancelar"
            Visible: =showArchiveDialog
            X: =confirmDialogFrame_2.X + (confirmDialogFrame_2.Width / 2) + 20
            Y: =confirmDialogFrame_2.Y + confirmDialogFrame_2.Height - Self.Height - 20
            ZIndex: =50

    deleteDialogGroup As group:
        Height: =5
        Width: =5
        X: =80
        Y: =80
        ZIndex: =62

        confirmDialogRect_3 As rectangle:
            DisplayMode: =DisplayMode.View
            Fill: =RGBA(0, 0, 0, 0.5)
            FocusedBorderThickness: =0
            Height: =Parent.Height
            Visible: =showDeleteDialog
            Width: =Parent.Width
            ZIndex: =51

        confirmDialogFrame_3 As button:
            BorderThickness: =0
            DisabledFill: =Color.White
            DisplayMode: =DisplayMode.Disabled
            FocusedBorderThickness: =0
            Height: =300
            RadiusBottomLeft: =20
            RadiusBottomRight: =20
            RadiusTopLeft: =20
            RadiusTopRight: =20
            Text: =""
            Visible: =showDeleteDialog
            Width: =600
            X: =Parent.Width / 2 - Self.Width / 2
            Y: =Parent.Height / 2 - Self.Height / 2
            ZIndex: =52

        confirmDialogTitle_3 As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Text: ="¿ESTA SEGURO DE ELIMINAR LA SOLICITUD?"
            Visible: =showDeleteDialog
            Width: =confirmDialogFrame_3.Width
            X: =confirmDialogFrame_3.X
            Y: =confirmDialogFrame_3.Y + 15
            ZIndex: =53

        commentaryLbl_1 As label:
            Height: =20
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =12
            Text: |-
                ="Comentario:"
            Visible: =showDeleteDialog
            Width: =100
            X: =confirmDialogFrame_3.X + 20
            Y: =confirmDialogTitle_3.Y + confirmDialogTitle_3.Height + 15
            ZIndex: =54

        TextInput3_1 As text:
            Default: =""
            Height: =120
            HintText: ="Ingrese un comentario..."
            Mode: =TextMode.MultiLine
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Visible: =showDeleteDialog
            Width: =confirmDialogFrame_3.X + confirmDialogFrame_3.Width - Self.X - 20
            X: =confirmDialogFrame_3.X + 20
            Y: =commentaryLbl.Y + commentaryLbl.Height + 5
            ZIndex: =55

        aceptarBtn_1 As button:
            DisplayMode: =If(IsBlank(TrimEnds(TextInput3_1.Text)), DisplayMode.Disabled, DisplayMode.Edit)
            OnSelect: |-
                =UpdateContext({ showDeleteDialog: false, isLoading: true });
                
                // Actualizar datos base de solicitud
                Patch(Solicitud, 
                	LookUp(Solicitud, ID = Gallery1.Selected.ID), 
                	{ 
                		EsActivo: false,
                		EsEliminado: true
                	}
                );
                
                // Crear Solicitud Detalle inicial
                UpdateContext({
                	lastSolicitudDetalle:
                		Patch(SolicitudDetalle,
                			Defaults(SolicitudDetalle),
                			{
                				IdSolicitud: Gallery1.Selected.IdSolicitud,
                				FechaAtencion: Today(),
                				FechaExpiraSLA: Gallery1.Selected.FechaExpiraSLA,
                                FechaExpiraOLA: Gallery1.Selected.FechaExpiraOLA,
                                // Cuando se deriva, la fecha OLA se debe volver a generar ya que cada Area tiene un OLA distinto
                				//FechaExpiraOLA: DateAdd(Today(); varMyUserArea.OLA);
                				EsAtendido: false,
                				IdAccionOrigen: 7, // Eliminar
                				IdEtapaOrigen: Gallery1.Selected.IdEtapaActual,
                				IdAreaOrigen: varMyUser.IdArea,
                				IdPerfilOrigen: varMyUser.IdPerfil,
                				IdPersonalOrigen: varMyUser.ID,
                				IdAccionActual: 0, // Lo actualizará el siguiente usuario
                				IdEtapaActual: 0,
                				IdAreaActual: 0,
                                // Si fuera derivar, Perfil y persona quedaria en 0 porque es de uno a muchos
                				IdPerfilActual: 0,
                				IdPersonalActual: 0,
                                IdAccionDestino: 0, // Siempre será 0 porque todavía no se toma en cuenta
                				IdEtapaDestino: 0, // Etapa Destino Real
                				IdAreaDestino: 0, // Area Destino Real
                				IdPerfilDestino: 0, // Perfil Destino Real
                				IdPersonalDestino: 0, // Personal Destino 
                                IdEtapaDestinoFlujo: varMyAreaEtapaFlujo.IdEtapaDestino,
                                IdAreaDestinoFlujo: varMyAreaEtapaFlujo.IdAreaDestino,
                                ObsSolDet: TrimEnds(TextInput3_1.Text)
                			}
                		)
                });
                
                // Actualizar Solicitud seleccionada con los datos de la persona que esta realizando la accion
                Patch(SolicitudDetalle, 
                    LookUp(SolicitudDetalle, ID = Gallery1.Selected.ID),
                    {
                        IdAccionActual: 7, // Eliminar
                        IdPerfilActual: varMyUser.IdPerfil,
                        IdPersonalActual: varMyUser.ID,
                        IdAreaDestino: 0,
                        IdEtapaDestino: 0,
                        IdPerfilDestino: 0,
                        IdPersonalDestino: 0,
                        EsAtendido: true, // Actualizar estado del registro seleccionado
                        IdSolicitudDetalleGenerada: lastSolicitudDetalle.ID, // Guardar ID de la solicitud detalle generada
                        ObsSolDetDestino: TrimEnds(TextInput3_1.Text)
                    }
                );
                
                Notify("Solicitud archivada correctamente.", NotificationType.Success);
                
                Reset(TextInput3_1);
                
                UpdateContext({ isLoading: false });
                
                Navigate(scrMisSolicitudes, Fade);
            Size: =12
            Text: ="Aceptar"
            Visible: =showDeleteDialog
            X: =confirmDialogFrame_3.X + (confirmDialogFrame_3.Width / 2) - Self.Width - 20
            Y: =confirmDialogFrame_3.Y + confirmDialogFrame_3.Height - Self.Height - 20
            ZIndex: =56

        cancelarBtn_1 As button:
            OnSelect: |-
                =UpdateContext({ showDeleteDialog: false });
                Reset(TextInput3_1)
            Size: =12
            Text: ="Cancelar"
            Visible: =showDeleteDialog
            X: =confirmDialogFrame_3.X + (confirmDialogFrame_3.Width / 2) + 20
            Y: =confirmDialogFrame_3.Y + confirmDialogFrame_3.Height - Self.Height - 20
            ZIndex: =57

