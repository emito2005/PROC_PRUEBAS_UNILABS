scrAsignar As screen:
    OnHidden: |-
        =Select(ClearSelectedUserIcon);
        Reset(TextInput2)
    OnVisible: =

    cmpBarraSuperior_10 As cmpBarraSuperior:

    lbl_TituloPrincipal_7 As label:
        Align: =Align.Center
        FontWeight: =FontWeight.Bold
        Height: =38
        Size: =24
        Text: ="ASIGNAR SOLICITUD"
        Width: =1335
        X: =13
        Y: =icn_Volver_NS_4.Y + (icn_Volver_NS_4.Height / 2) - (Self.Height / 2)
        ZIndex: =2

    icn_Volver_NS_4 As icon.BackArrow:
        Color: =icn_Volver_NS_1.Color
        Icon: =Icon.BackArrow
        OnSelect: =Back();
        X: =icn_Volver_NS_1.X
        Y: =icn_Volver_NS_1.Y
        ZIndex: =3

    Button5_1 As button:
        DisplayMode: =If(!IsBlank(UserSelected), DisplayMode.Edit, DisplayMode.Disabled)
        Fill: =varColorPri01
        HoverFill: =ColorFade(Self.Fill, -10%)
        OnSelect: |-
            =UpdateContext({ isLoading: true });
            
            // Crear Solicitud Detalle inicial
            UpdateContext({
            	lastSolicitudDetalle:
            		Patch(SolicitudDetalle,
            			Defaults(SolicitudDetalle),
            			{
            				IdSolicitud: varSolicitudDetalleItemSel.IdSolicitud,
            				FechaCreacion: Today(),
            				FechaExpiraSLA: varSolicitudDetalleItemSel.FechaExpiraSLA,
                            FechaExpiraOLA: varSolicitudDetalleItemSel.FechaExpiraOLA,
                            // Cuando se deriva, la fecha OLA se debe volver a generar ya que cada Area tiene un OLA distinto
            				//FechaExpiraOLA: DateAdd(Today(); varMyUserArea.OLA);
            				EsAtendido: false,
            				IdAccionOrigen: 2, // Asignar
            				IdEtapaOrigen: varSolicitudDetalleItemSel.IdEtapaActual,
            				IdAreaOrigen: varMyUser.IdArea,
            				IdPerfilOrigen: varMyUser.IdPerfil,
            				IdPersonalOrigen: varMyUser.ID,
            				IdAccionActual: 0, // Lo actualizará el siguiente usuario
            				IdEtapaActual: varSolicitudDetalleItemSel.IdEtapaActual,
            				IdAreaActual: varSolicitudDetalleItemSel.IdAreaActual,
                            // Si fuera derivar, Perfil y persona quedaria en 0 porque es de uno a muchos
            				IdPerfilActual: LookUp(Personal, Email = UserSelected.Email).IdPerfil,
            				IdPersonalActual: LookUp(Personal, Email = UserSelected.Email).ID,
                            IdAccionDestino: 0, // Siempre será 0 porque todavía no se toma en cuenta
            				IdEtapaDestino: 0, // Etapa Destino Real
            				IdAreaDestino: 0, // Area Destino Real
            				IdPerfilDestino: 0, // Perfil Destino Real
            				IdPersonalDestino: 0, // Personal Destino 
                            //IdEtapaDestinoFlujo: varMyAreaEtapaFlujo.IdEtapaDestino;
                            IdEtapaDestinoFlujo: varSolicitudDetalleItemSel.IdEtapaDestinoFlujo,
                            //IdAreaDestinoFlujo: varMyAreaEtapaFlujo.IdAreaDestino;
                            IdAreaDestinoFlujo: varSolicitudDetalleItemSel.IdAreaDestinoFlujo,
                            ObsSolDet: TrimEnds(TextInput2.Text)
            			}
            		)
            });
            
            // Crear Solicitud Detalle Destino del siguiente usuario
            Patch(SolicitudDetalleDestino,
            	Defaults(SolicitudDetalleDestino),
            	{
            		IdSolicitud: lastSolicitudDetalle.IdSolicitud,
            		IdSolicitudDetalle: lastSolicitudDetalle.ID,
            		IdEtapaDestino: lastSolicitudDetalle.IdEtapaActual,
            		IdAreaDestino: lastSolicitudDetalle.IdAreaActual,
            		IdPerfilDestino: lastSolicitudDetalle.IdPerfilActual,
            		IdPersonalDestino: lastSolicitudDetalle.IdPersonalActual
            	}
            );
            
            // Actualizar Solicitud seleccionada con los datos de la persona que esta realizando la accion
            Patch(SolicitudDetalle, 
                LookUp(SolicitudDetalle, ID = varSolicitudDetalleItemSel.ID),
                {
                    IdAccionActual: 2, // Asignar
                    IdPerfilActual: varMyUser.IdPerfil,
                    IdPersonalActual: varMyUser.ID,
                    IdAreaDestino: varSolicitudDetalleItemSel.IdAreaActual,
                    IdEtapaDestino: varSolicitudDetalleItemSel.IdEtapaActual,
                    IdPerfilDestino: LookUp(Personal, Email = UserSelected.Email).IdPerfil,
                    IdPersonalDestino: LookUp(Personal, Email = UserSelected.Email).ID,
                    EsAtendido: true, // Actualizar estado del registro seleccionado
                    IdSolicitudDetalleGenerada: lastSolicitudDetalle.ID, // Guardar ID de la solicitud detalle generada
                    ObsSolDetDestino: TrimEnds(TextInput2.Text),
                    FechaAtencion: Today()
                }
            );
            
            Notify("Solicitud asignada correctamente.", NotificationType.Success);
            
            UpdateContext({ isLoading: false });
            
            Navigate(scrMisSolicitudes, Fade);
        Text: ="ASIGNAR"
        Width: =Parent.Width / 2
        X: =Parent.Width / 2 - Self.Width / 2
        Y: =Parent.Height - Self.Height - 35
        ZIndex: =25

    upperToGroup_1 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =34

        requestFieldLbl_41 As label:
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: |-
                ="Asignar Solicitud a:"
            Width: =155
            X: =Button8_10.X
            Y: =Button8_10.Y + Button8_10.Height + 15
            ZIndex: =26

        txtBuscarManager_2 As text:
            Align: =Left
            BorderColor: =varColorPri01B
            Color: =RGBA(0, 0, 0, 1)
            Default: =""
            DisabledFill: =ColorFade(Color.Black, 0.95)//Self.Fill
            DisplayMode: |
                =// Disable if UserSelected is blank
                If(IsBlank(UserSelected),
                     DisplayMode.Edit,
                     DisplayMode.Disabled
                )
            HintText: ="Buscar"
            HoverBorderColor: =varColorPri01B
            HoverColor: =RGBA(0, 0, 0, 1)
            HoverFill: =varColorPri01B
            PaddingLeft: =35
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Size: =13
            Width: =354
            X: =requestFieldLbl_41.X + requestFieldLbl_41.Width + 10
            Y: =requestFieldLbl_41.Y + (requestFieldLbl_41.Height / 2) - (Self.Height / 2)
            ZIndex: =27

        SearchIcon1_5 As icon.Search:
            BorderColor: =RGBA(0, 0, 0, 0)
            Color: =RGBA(0, 0, 0, 1)
            DisabledColor: =RGBA(220, 220, 220, 1)
            DisabledFill: =RGBA(0, 0, 0, 0)
            DisplayMode: =If(txtBuscarManager_2.DisplayMode = DisplayMode.Edit, DisplayMode.Edit, DisplayMode.View)
            FocusedBorderThickness: =4
            Height: =30
            HoverBorderColor: =RGBA(0, 0, 0, 0)
            HoverColor: =ColorFade(RGBA(135, 100, 184, 1), -30%)
            HoverFill: =RGBA(0, 0, 0, 0)
            Icon: =Icon.Search
            PaddingBottom: =8
            PaddingLeft: =8
            PaddingRight: =8
            PaddingTop: =8
            PressedBorderColor: =RGBA(0, 0, 0, 0)
            PressedColor: =ColorFade(RGBA(135, 100, 184, 1), -30%)
            PressedFill: =RGBA(0, 0, 0, 0)
            Tooltip: ="Buscar"
            Width: =38
            X: =txtBuscarManager_2.X
            Y: =txtBuscarManager_2.Y + (txtBuscarManager_2.Height / 2) - (Self.Height / 2)
            ZIndex: =28

        UserBrowseGallery1_5 As gallery.PeoplePickerTabletGallery:
            AccessibleLabel: ="Resultados de la búsqueda de usuarios"
            BorderColor: =RGBA(166, 166, 166, 1)
            BorderThickness: =1
            Default: ={}
            Fill: =RGBA(255, 255, 255, 1)
            Height: =Parent.Height - Self.Y - 20
            Items: |-
                =// Validate if textField is not blank
                //If(!IsBlank(Trim(txtBuscarManager_2.Text));
                	If(varMyUser.IdPerfil = 2, // Manager
                		/*Filter(UsuariosdeOffice365.SearchUser({ searchTerm: Trim(txtBuscarManager_2.Text); top: 999 });
                			UserPrincipalName in AddColumns(Filter(AreaManagerLider; IdAreaManager = MyAreaManagerID); "EmailPersonalML"; LookUp(Personal; ID = IdPersonal).Email).EmailPersonalML
                		);*/
                        Filter(Personal,
                            IdPerfil = 3, // Leader
                            IdArea = varMyUser.IdArea,
                            StartsWith(Nombre, txtBuscarManager_2.Text)
                        ),
                		
                		varMyUser.IdPerfil = 3, // Leader
                		/*Filter(UsuariosdeOffice365.SearchUser({ searchTerm: Trim(txtBuscarManager_2.Text); top: 999 });
                			UserPrincipalName in AddColumns(Filter(AreaManagerLiderAnalista; IdAreaManagerLider = MyAreaManagerLiderID); "EmailPersonalMLA"; LookUp(Personal; ID = IdPersonal).Email).EmailPersonalMLA
                		)*/
                        Filter(Personal,
                            IdPerfil = 4, // Analyst
                            IdArea = varMyUser.IdArea,
                            StartsWith(Nombre, txtBuscarManager_2.Text)
                        )
                	)
                //)
            Layout: =Layout.Vertical
            OnSelect: |-
                =UpdateContext({ UserSelected: UserBrowseGallery1_5.Selected });
                Reset(txtBuscarManager_2);
            ShowScrollbar: =false
            TemplatePadding: =0
            TemplateSize: =60
            Visible: =IsBlank(UserSelected)
            Width: =txtBuscarManager_2.Width
            X: =txtBuscarManager_2.X
            Y: =txtBuscarManager_2.Y + txtBuscarManager_2.Height + 5
            ZIndex: =29

            Rectangle2_5 As rectangle:
                BorderColor: =varColorPri01//Title2_8.Color
                BorderThickness: |-
                    =//If(ThisItem.UserPrincipalName in MyPeople.UserPrincipalName; 2; 0)
                    1
                DisabledFill: =RGBA(166, 166, 166, 1)
                Fill: =RGBA(0,0,0,0)
                Height: =58
                HoverFill: =RGBA(0,0,0,0)
                OnSelect: =Select(Title2_8)
                PressedFill: =RGBA(135, 100, 184, 1)
                Width: =Parent.TemplateWidth - 2*Self.X
                X: =1
                Y: =1
                ZIndex: =1

            Title2_8 As label:
                BorderColor: =Self.Color
                Color: =RGBA(51, 51, 51, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                FocusedBorderThickness: =2
                Font: =Font.'Segoe UI'
                FontWeight: =FontWeight.Semibold
                Height: =Self.Size * 1.8
                OnSelect: =Select(Parent);
                Size: =12
                TabIndex: =0
                Text: =ThisItem.Nombre
                VerticalAlign: =Middle
                Width: =UserBrowseGallery1_5.TemplateWidth - 30
                Wrap: =false
                X: =5
                Y: =9
                ZIndex: =4

            Subtitle1_5 As label:
                Color: =RGBA(51, 51, 51, 1)
                FocusedBorderThickness: =2
                Font: =Font.'Segoe UI'
                Height: =Self.Size * 1.8
                OnSelect: =Select(Title2_8)
                Size: =12
                Text: =ThisItem.Email
                VerticalAlign: =Middle
                Width: =Title2_8.Width
                Wrap: =false
                X: =5
                Y: =31
                ZIndex: =5

            Separator1_5 As rectangle:
                BorderColor: =RGBA(0, 0, 0, 0)
                Fill: =varColorPri01//ColorFade(RGBA(135; 100; 184; 1); -30%)
                Height: =1
                OnSelect: =Select(Parent)
                Width: =Parent.TemplateWidth
                Y: =58
                ZIndex: =6

    TextInput2 As text:
        BorderColor: =varColorPri01B
        Default: =""
        Height: =Icon6.Y + Icon6.Height - Self.Y
        HoverBorderColor: =varColorPri01B
        HoverFill: =varColorPri01B
        Mode: =TextMode.MultiLine
        RadiusBottomLeft: =0
        RadiusBottomRight: =0
        RadiusTopLeft: =0
        RadiusTopRight: =0
        Width: =Rectangle5_10.X + Rectangle5_10.Width - Self.X
        X: =requestFieldLbl_39.X
        Y: =requestFieldLbl_39.Y + requestFieldLbl_39.Height
        ZIndex: =35

    Rectangle2 As rectangle:
        Fill: =RGBA(0, 0, 0, 0.4)
        Height: =Parent.Height
        Visible: =isLoading
        Width: =Parent.Width
        ZIndex: =36

    Group1 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =36

        Label5 As label:
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: |-
                ="Usuario seleccionado:"
            Visible: =!IsBlank(UserSelected)
            Width: =txtBuscarManager_2.X + txtBuscarManager_2.Width - Self.X - 50
            X: =requestFieldLbl_41.X
            Y: =requestFieldLbl_41.Y + requestFieldLbl_41.Height + 5
            ZIndex: =30

        Icon6 As icon.Person:
            Color: =varColorPri01
            DisplayMode: =DisplayMode.View
            Icon: =Icon.Person
            Visible: =!IsBlank(UserSelected)
            X: =Label5.X
            Y: =Label5.Y + Label5.Height + 5
            ZIndex: =31

        Label5_1 As label:
            Height: =Icon6.Height / 2
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: =UserSelected.Nombre
            Visible: =!IsBlank(UserSelected)
            Width: =Label5.X + Label5.Width - Self.X
            X: =Icon6.X + Icon6.Width
            Y: =Icon6.Y
            ZIndex: =32

        Label5_2 As label:
            Height: =Icon6.Height / 2
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: =UserSelected.Email
            Visible: =!IsBlank(UserSelected)
            Width: =Label5.X + Label5.Width - Self.X
            X: =Icon6.X + Icon6.Width
            Y: =Label5_1.Y + Label5_1.Height
            ZIndex: =33

        ClearSelectedUserIcon As icon.Cancel:
            Color: =varColorPri01
            Height: =40
            Icon: =Icon.Cancel
            OnSelect: |-
                =Reset(txtBuscarManager_2);
                Reset(UserBrowseGallery1_5);
                UpdateContext({ UserSelected: Blank() })
            Tooltip: ="Cancelar selección"
            Visible: =!IsBlank(UserSelected)
            Width: =40
            X: =Label5_1.X + Label5_1.Width + 5
            Y: =Icon6.Y + (Icon6.Height / 2) - (Self.Height / 2)
            ZIndex: =34

    Group7_2 As group:
        Height: =5
        Width: =5
        X: =60
        Y: =60
        ZIndex: =63

        requestFieldLbl_82 As label:
            FontWeight: =FontWeight.Semibold
            Height: =20
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="F. Creación"
            Width: =(Parent.Width - 200) / 3
            X: =Button8_9.X
            Y: =Button8_9.Y + Button8_9.Height + 15
            ZIndex: =53

        requestFieldTxt_55 As text:
            BorderThickness: =0
            Default: =varSolicitudDetalleItemSel.FechaCreacion
            DisabledColor: =requestFieldTxt_20.DisabledColor
            DisabledFill: =requestFieldTxt_20.DisabledFill
            DisplayMode: =DisplayMode.Disabled
            FocusedBorderThickness: =0
            Height: =25
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =requestFieldLbl_82.Width
            X: =requestFieldLbl_82.X
            Y: =requestFieldLbl_82.Y + requestFieldLbl_82.Height
            ZIndex: =54

        requestFieldLbl_83 As label:
            FontWeight: =FontWeight.Semibold
            Height: =20
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="F. Expiración SLA"
            Width: =(Parent.Width - 200) / 3
            X: =requestFieldLbl_82.X + requestFieldLbl_82.Width + 50
            Y: =requestFieldLbl_82.Y
            ZIndex: =55

        requestFieldTxt_56 As text:
            BorderThickness: =0
            Default: =Text(varSolicitudDetalleItemSel.FechaExpiraSLA, "dd/mm/yyyy")
            DisabledColor: =requestFieldTxt_20.DisabledColor
            DisabledFill: =requestFieldTxt_20.DisabledFill
            DisplayMode: =DisplayMode.Disabled
            FocusedBorderThickness: =0
            Height: =25
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =requestFieldLbl_83.Width
            X: =requestFieldLbl_83.X
            Y: =requestFieldLbl_83.Y + requestFieldLbl_83.Height
            ZIndex: =56

        requestFieldLbl_84 As label:
            FontWeight: =FontWeight.Semibold
            Height: =20
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: ="F. Expiración OLA"
            Width: =(Parent.Width - 200) / 3
            X: =requestFieldLbl_83.X + requestFieldLbl_83.Width + 50
            Y: =requestFieldLbl_82.Y
            ZIndex: =57

        requestFieldTxt_57 As text:
            BorderThickness: =0
            Default: =Text(varSolicitudDetalleItemSel.FechaExpiraOLA, "dd/mm/yyyy")
            DisabledColor: =requestFieldTxt_20.DisabledColor
            DisabledFill: =requestFieldTxt_20.DisabledFill
            DisplayMode: =DisplayMode.Disabled
            FocusedBorderThickness: =0
            Height: =25
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =requestFieldLbl_84.Width
            X: =requestFieldLbl_84.X
            Y: =requestFieldLbl_84.Y + requestFieldLbl_84.Height
            ZIndex: =58

    Group8_5 As group:
        Height: =5
        Width: =5
        X: =60
        Y: =60
        ZIndex: =64

        Button8_5 As button:
            Align: =Align.Left
            BorderThickness: =0
            DisabledColor: =RGBA(255, 255, 255, 1)
            DisabledFill: =varColorPri01
            DisplayMode: =DisplayMode.Disabled
            FocusedBorderThickness: =0
            PaddingLeft: =15
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =40
            Text: ="Datos de Solicitud"
            Width: =230
            X: =50
            Y: =115
            ZIndex: =37

        Rectangle5_5 As rectangle:
            Fill: =varColorPri01
            Height: =2
            Width: =Parent.Width - Self.X - 50
            X: =Button8_5.X
            Y: =Button8_5.Y + Button8_5.Height - Self.Height
            ZIndex: =38

    descriptionGroup_2 As group:
        Height: =5
        Width: =5
        X: =748
        Y: =240
        ZIndex: =65

    Group8_9 As group:
        Height: =5
        Width: =5
        X: =70
        Y: =500
        ZIndex: =66

        Button8_9 As button:
            Align: =Align.Left
            BorderThickness: =0
            DisabledColor: =RGBA(255, 255, 255, 1)
            DisabledFill: =varColorPri01
            DisplayMode: =DisplayMode.Disabled
            FocusedBorderThickness: =0
            PaddingLeft: =15
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =40
            Text: ="Datos de Fecha"
            Width: =230
            X: =requestFieldTxt_24.X
            Y: =requestFieldTxt_24.Y + requestFieldTxt_24.Height + 15
            ZIndex: =39

        Rectangle5_9 As rectangle:
            Fill: =varColorPri01
            Height: =2
            Width: =Parent.Width - Self.X - 50
            X: =Button8_9.X
            Y: =Button8_9.Y + Button8_9.Height - Self.Height
            ZIndex: =40

    Group8_10 As group:
        Height: =5
        Width: =5
        X: =70
        Y: =280
        ZIndex: =67

        Button8_10 As button:
            Align: =Align.Left
            BorderThickness: =0
            DisabledColor: =RGBA(255, 255, 255, 1)
            DisabledFill: =varColorPri01
            DisplayMode: =DisplayMode.Disabled
            FocusedBorderThickness: =0
            PaddingLeft: =15
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =40
            Text: ="Datos de Operación"
            Width: =240
            X: =requestFieldTxt_55.X
            Y: =requestFieldTxt_55.Y + requestFieldTxt_55.Height + 15
            ZIndex: =61

        Rectangle5_10 As rectangle:
            Fill: =varColorPri01
            Height: =2
            Width: =Parent.Width - Self.X - 50
            X: =Button8_10.X
            Y: =Button8_10.Y + Button8_10.Height - Self.Height
            ZIndex: =62

