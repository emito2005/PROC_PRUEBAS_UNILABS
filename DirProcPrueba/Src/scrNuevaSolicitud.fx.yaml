scrNuevaSolicitud As screen:
    Fill: =
    OnVisible: |-
        =Set(varIdTipoServicio,ddwTipoServicio.Selected.ID);
        Set(varIdTipoSolicitud,ddwTipoSolicitud.Selected.ID);
        ResetForm(frm_EditSolicitud);
        ResetForm(frmDatosAdjuntos);
        NewForm(frm_EditSolicitud);
        NewForm(frmDatosAdjuntos);

    Rectangle4_1 As rectangle:
        BorderColor: =RGBA(255, 191, 0, 1)
        BorderThickness: =1
        Fill: =RGBA(255, 255, 255, 1)
        Height: =670
        Width: =1339
        X: =13
        Y: =89
        ZIndex: =1

    cmpBarraSuperior_4 As cmpBarraSuperior:
        ZIndex: =2

    lbl_TituloPrincipal_1 As label:
        Align: =Align.Center
        FontWeight: =FontWeight.Bold
        Height: =38
        Size: =24
        Text: ="CREACION DE SOLICITUD"
        Width: =1335
        X: =13
        Y: =96
        ZIndex: =3

    btnGrabar As button:
        Fill: =RGBA(0, 0, 0, 1)
        Height: =45
        OnSelect: |-
            =SubmitForm(frm_EditSolicitud);
            Select(icn_Volver_NS)
        Text: ="CREAR SOLICITUD"
        Width: =720
        X: =372
        Y: =700
        ZIndex: =4

    icn_Volver_NS As icon.BackArrow:
        Icon: =Icon.BackArrow
        OnSelect: =ResetForm(frm_EditSolicitud);Select(gaMenuLateral_NS,2,Button2_4);
        X: =20
        Y: =112
        ZIndex: =5

    frm_EditSolicitud As form:
        DataSource: =Solicitud
        DefaultMode: =FormMode.New
        Height: =466
        OnSuccess: |
            =// Guardar ID de la nueva solicitud
            Set(varIdSolNueva, frm_EditSolicitud.LastSubmit.ID);
            
            // Actualizar último ID de solicitud generado
            Set(varNroSolActual, LookUp(Parametros, Codigo = "NROSOL").Valor);
            
            Set(varNroSolNuevo, Value(varNroSolActual) + 1);
            
            Patch(Parametros, 
            	LookUp(Parametros, Codigo = "NROSOL"),
            	{
            		Valor: varNroSolNuevo
            	}
            );
            
            Set(varNroSolGenerada, "");
            
            // Crear Solicitud Detalle inicial
            Set(varLastPatchSolicitudDetalle,
            	Patch(SolicitudDetalle,
            		Defaults(SolicitudDetalle),
            		{
            			IdSolicitud: varIdSolNueva,
            			FechaAtencion: Today(),
            			FechaExpiraSLA: DateAdd(Today(), varMyUserArea.SLA),
            			FechaExpiraOLA: DateAdd(Today(), varMyUserArea.OLA),
            			EsAtendido: false,
            			IdAccionOrigen: 1, //Generar(Crear) - los datos de ORIGEN al inicio de generar son los mismos que los datos de ACTUAL
            			IdEtapaOrigen: varMyAreaEtapaFlujo.IdEtapa,
            			IdAreaOrigen: varMyAreaEtapaFlujo.IdArea,
            			IdPerfilOrigen: varMyUser.IdPerfil,
            			IdPersonalOrigen: varMyUser.ID,
            			IdAccionActual: 0,  //se actualiza cuando con el usuario realiza la accion
            			IdEtapaActual: varMyAreaEtapaFlujo.IdEtapa,
            			IdAreaActual: varMyAreaEtapaFlujo.IdArea,
            			IdPerfilActual: 0,  //se actualiza cuando con el usuario realiza la accion
            			IdPersonalActual: 0,    //se actualiza cuando con el usuario realiza la accion
            			IdAccionDestino: 0, //no es necesario por el momento
            			IdEtapaDestino: 0, //se actualiza cuando el usuario realiza la accion
            			IdAreaDestino: 0,   //se actualiza cuando el usuario realiza la accion
            			IdPerfilDestino: 0, //llenar cuando es a una sola persona, o sea cuando NO ES Derivar(derivar al ser varios destinos se graba en detalle destino)
            			IdPersonalDestino: 0,   //llenar cuando es a una sola persona, o sea cuando NO ES Derivar(derivar al ser varios destinos se graba en detalle destino)
                        IdEtapaDestinoFlujo:varMyAreaEtapaFlujo.IdEtapaDestino,
                        IdAreaDestinoFlujo: varMyAreaEtapaFlujo.IdAreaDestino
            		},
                    frmDatosAdjuntos.Updates
            	)
            );
            
            // Obtener mis managers
            Clear(colMyManagers);
            ClearCollect(colMyManagers,
            	Filter(AreaManager, IdArea = varMyUser.IdArea)
            );
            
            // Obtener mis líderes
            Clear(colMyLideres);
            ClearCollect(colMyLideres,
            	Filter(AreaManagerLider, IdArea = varMyUser.IdArea)
            );
            
            // Validar si se notificará a los managers
            If(varMyUserArea.NotificaManager,
            	ForAll(colMyManagers,
            		Patch(SolicitudDetalleDestino,
            			Defaults(SolicitudDetalleDestino),
            			{
            				IdSolicitud: varLastPatchSolicitudDetalle.IdSolicitud,
            				IdSolicitudDetalle: varLastPatchSolicitudDetalle.ID,
            				IdEtapaDestino: varMyAreaEtapaFlujo.IdEtapa,
            				IdAreaDestino: varMyAreaEtapaFlujo.IdArea,
            				IdPerfilDestino: 2,
            				IdPersonalDestino: IdPersonal
            			}
            		)
            	)
            );
            
            // Validar si se notificará a los líderes
            If(varMyUserArea.NotificaLider,
            	ForAll(colMyLideres,
            		Patch(SolicitudDetalleDestino,
            			Defaults(SolicitudDetalleDestino),
            			{
            				IdSolicitud: varLastPatchSolicitudDetalle.IdSolicitud,
            				IdSolicitudDetalle: varLastPatchSolicitudDetalle.ID,
            				IdEtapaDestino: varMyAreaEtapaFlujo.IdEtapa,
            				IdAreaDestino: varMyAreaEtapaFlujo.IdArea,
            				IdPerfilDestino: 3,
            				IdPersonalDestino: IdPersonal
            			}
            		)
            	)
            );
        Width: =1076
        X: =173
        Y: =133
        ZIndex: =6

        IdTipoSolicitud_DataCard3 As typedDataCard.numberEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="IdTipoSolicitud"
            Default: |-
                =//ThisItem.IdTipoSolicitud
                varIdTipoSolicitud
            DisplayMode: =Parent.DisplayMode
            DisplayName: |
                =//DataSourceInfo([@Solicitud];DataSourceInfo.DisplayName;"IdTipoSolicitud")
                "Tipo de Solicitud"
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            Required: =false
            Update: =Value(DataCardValue35.Text)
            Width: =358
            X: =1
            Y: =0
            ZIndex: =1

            DataCardKey35 As label:
                AutoHeight: =true
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue35 As text:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                Default: =Parent.Default
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                Format: =TextFormat.Number
                PaddingLeft: =5
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: =Parent.DisplayName
                Visible: =false
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey35.Y + DataCardKey35.Height + 5
                ZIndex: =2

            ErrorMessage28 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue35.Y + DataCardValue35.Height
                ZIndex: =3

            StarVisible28 As label:
                Align: =Align.Center
                Height: =DataCardKey35.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey35.Y
                ZIndex: =4

            ddwTipoSolicitud As dropdown:
                Items: =TipoSolicitud
                OnChange: =Set(varIdTipoSolicitud,ddwTipoSolicitud.Selected.ID)
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey35.Y + DataCardKey35.Height + 5
                ZIndex: =5

        IdTipoServicio_DataCard3 As typedDataCard.numberEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="IdTipoServicio"
            Default: |-
                =//ThisItem.IdTipoServicio
                varIdTipoServicio
            DisplayMode: =Parent.DisplayMode
            DisplayName: |
                =//DataSourceInfo([@Solicitud];DataSourceInfo.DisplayName;"IdTipoServicio")
                "Tipo de Servicio"
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            Required: =false
            Update: =Value(DataCardValue34.Text)
            Width: =358
            X: =2
            Y: =0
            ZIndex: =1

            DataCardKey34 As label:
                AutoHeight: =true
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue34 As text:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                Default: =Parent.Default
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                Format: =TextFormat.Number
                PaddingLeft: =5
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: =Parent.DisplayName
                Visible: =false
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey34.Y + DataCardKey34.Height + 5
                ZIndex: =2

            ErrorMessage27 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue34.Y + DataCardValue34.Height
                ZIndex: =3

            StarVisible27 As label:
                Align: =Align.Center
                Height: =DataCardKey34.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey34.Y
                ZIndex: =4

            ddwTipoServicio As dropdown:
                Height: =37
                Items: =TipoServicio
                OnChange: =Set(varIdTipoServicio,ddwTipoServicio.Selected.ID)
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey34.Y + DataCardKey34.Height + 5
                ZIndex: =5

        NroSolicitud_DataCard1 As typedDataCard.textualEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="NroSolicitud"
            Default: |
                =//ThisItem.NroSolicitud
                Concatenate(LookUp(Parametros,Codigo="PREFIJONROSOL",Valor),Right(Concatenate("000000",LookUp(Parametros,Codigo="NROSOL",Valor)),6))
            DisplayMode: |+
                =//Parent.DisplayMode
                DisplayMode.View
                
            DisplayName: |-
                =//DataSourceInfo([@Solicitud];DataSourceInfo.DisplayName;"NroSolicitud")
                "Nro. Solicitud"
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            MaxLength: =DataSourceInfo([@Solicitud], DataSourceInfo.MaxLength, "NroSolicitud")
            Required: =false
            Update: =DataCardValue16.Text
            Width: =358
            X: =0
            Y: =0
            ZIndex: =7

            DataCardKey16 As label:
                AutoHeight: =true
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue16 As text:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                Default: =Parent.Default
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                MaxLength: =Parent.MaxLength
                PaddingLeft: =5
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey16.Y + DataCardKey16.Height + 5
                ZIndex: =2

            ErrorMessage9 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue16.Y + DataCardValue16.Height
                ZIndex: =3

            StarVisible9 As label:
                Align: =Align.Center
                Height: =DataCardKey16.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey16.Y
                ZIndex: =4

        NombreSolicitud_DataCard1 As typedDataCard.textualEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="NombreSolicitud"
            Default: =ThisItem.NombreSolicitud
            DisplayMode: =Parent.DisplayMode
            DisplayName: |-
                =//DataSourceInfo([@Solicitud];DataSourceInfo.DisplayName;"NombreSolicitud")
                "Nombre de Solicitud"
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            MaxLength: =DataSourceInfo([@Solicitud], DataSourceInfo.MaxLength, "NombreSolicitud")
            Required: =false
            Update: =DataCardValue17.Text
            Width: =800
            X: =0
            Y: =1
            ZIndex: =7

            DataCardKey17 As label:
                AutoHeight: =true
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue17 As text:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                Default: =Parent.Default
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                MaxLength: =Parent.MaxLength
                PaddingLeft: =5
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey17.Y + DataCardKey17.Height + 5
                ZIndex: =2

            ErrorMessage10 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue17.Y + DataCardValue17.Height
                ZIndex: =3

            StarVisible10 As label:
                Align: =Align.Center
                Height: =DataCardKey17.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey17.Y
                ZIndex: =4

        Obs_DataCard3 As typedDataCard.textualEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="Obs"
            Default: =ThisItem.Obs
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Solicitud],DataSourceInfo.DisplayName,"Obs")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            MaxLength: =DataSourceInfo([@Solicitud], DataSourceInfo.MaxLength, "Obs")
            Required: =false
            Update: =DataCardValue18.Text
            Width: =620
            X: =0
            Y: =2
            ZIndex: =7

            DataCardKey18 As label:
                AutoHeight: =true
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue18 As text:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                Default: =Parent.Default
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                Height: =135
                MaxLength: =Parent.MaxLength
                Mode: =TextMode.MultiLine
                PaddingLeft: =5
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey18.Y + DataCardKey18.Height + 5
                ZIndex: =2

            ErrorMessage11 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                Y: =DataCardValue18.Y + DataCardValue18.Height
                ZIndex: =3

            StarVisible11 As label:
                Align: =Align.Center
                Height: =DataCardKey18.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey18.Y
                ZIndex: =4

    gaMenuLateral_NS As gallery.galleryVertical:
        Height: =81
        Items: =colBarraLateral
        Layout: =Layout.Vertical
        TemplateSize: =61
        Transition: =Transition.Pop
        Visible: =false
        Width: =84
        Y: =191
        ZIndex: =7

        Button2_4 As button:
            Align: =Align.Left
            Fill: =If(ThisItem.texto_boton=varOpcionMenu,RGBA(221, 79, 14, 1),RGBA(221, 79, 14, 70%))
            Height: =61
            HoverFill: =ColorFade(RGBA(221, 79, 14, 1), -20%)
            OnSelect: |-
                =Set(varIdOpcionMenu,ThisItem.id_boton);
                Set(varOpcionMenu,ThisItem.texto_boton);
                Navigate(ThisItem.navegacion,ScreenTransition.Cover)
            PaddingLeft: |
                =ThisItem.sangria*10
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Text: =ThisItem.texto_boton
            Width: =142
            X: =1
            ZIndex: =1

    frmDatosAdjuntos As form:
        DataSource: =SolicitudDetalle
        Height: =364
        NumberOfColumns: =1
        Width: =493
        X: =772
        Y: =331
        ZIndex: =8

        "'Datos adjuntos_DataCard2' As typedDataCard.attachmentsEditCard":
            BorderStyle: =BorderStyle.Solid
            DataField: ="{Attachments}"
            Default: =ThisItem.'Datos adjuntos'
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@SolicitudDetalle],DataSourceInfo.DisplayName,"{Attachments}")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =359
            Required: =false
            Update: =DataCardValue49.Attachments
            Width: =493
            X: =0
            Y: =0
            ZIndex: =9

            DataCardKey48 As label:
                AutoHeight: =true
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue49 As attachments:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                DisplayMode: =Parent.DisplayMode
                IsInDataCard: =true
                Items: =Parent.Default
                PaddingBottom: =5
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                PaddingRight: =5
                PaddingTop: =5
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey48.Y + DataCardKey48.Height + 5
                ZIndex: =2

            ErrorMessage40 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue49.Y + DataCardValue49.Height
                ZIndex: =3

            StarVisible40 As label:
                Align: =Align.Center
                Height: =DataCardKey48.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey48.Y
                ZIndex: =4

